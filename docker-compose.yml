version: "3.3"
services:
  # Watchtower
  watchtower:
    container_name: watchtower
    image: containrrr/watchtower:latest
    restart: unless-stopped
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_LABEL_ENABLE=true
      - WATCHTOWER_INCLUDE_RESTARTING=true
    labels:
      - com.centurylinklabs.watchtower.enable=true

  # SWAG - Secure Web Application Gateway
  swag:
    container_name: swag
    cap_add:
      - NET_ADMIN
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/GMT}
      - URL=${DOMAIN}
      - SUBDOMAINS=${SUBDOMAINS:-plex,qbittorrent,radarr,sonarr,bazarr,prowlarr}
      - ONLY_SUBDOMAINS=true
      - DNSPLUGIN=${DNSPLUGIN:-cloudflare}
      - VALIDATION=${VALIDATION:-dns}
      - PROPAGATION=20
    image: ghcr.io/linuxserver/swag:latest
    ports:
      - 80:80
      - 443:443
    restart: unless-stopped
    volumes:
      - ${DOCKER:-/opt}/swag:/config
    labels:
      - com.centurylinklabs.watchtower.enable=true

  # qBittorrent
  qbittorrent:
    container_name: qbittorrent
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/GMT}
    image: lscr.io/linuxserver/qbittorrent:latest
    restart: unless-stopped
    depends_on:
      - swag
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER:-/opt}/qbittorrent:/config
      - ${STORAGE:-/storage}:/storage
    ports:
      - 127.0.0.1:8080:8080
      - 127.0.0.1:6881:6881
      - 127.0.0.1:6881:6881/udp
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.centurylinklabs.watchtower.depends-on=swag

  # Plex
  plex:
    container_name: plex
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - VERSION=docker
      - TZ=${TZ:-Etc/GMT}
      - PLEX_CLAIM=${PLEX_CLAIM}
    image: lscr.io/linuxserver/plex:latest
    restart: unless-stopped
    depends_on:
      - swag
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER:-/opt}/plex:/config
      - ${STORAGE:-/storage}:/storage
    ports:
      - 127.0.0.1:32400:32400
      - 127.0.0.1:1900:1900/udp
      - 127.0.0.1:3005:3005
      - 127.0.0.1:5353:5353/udp
      - 127.0.0.1:8324:8324
      - 127.0.0.1:32410:32410/udp
      - 127.0.0.1:32412:32412/udp
      - 127.0.0.1:32413:32413/udp
      - 127.0.0.1:32414:32414/udp
      - 127.0.0.1:32469:32469
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.centurylinklabs.watchtower.depends-on=swag

  # Prowlarr
  prowlarr:
    container_name: prowlarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/GMT}
    image: lscr.io/linuxserver/prowlarr:develop
    restart: unless-stopped
    depends_on:
      - swag
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER:-/opt}/prowlarr:/config
    ports:
      - 127.0.0.1:9696:9696
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.centurylinklabs.watchtower.depends-on=swag

  # Radarr
  radarr:
    container_name: radarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/GMT}
    image: lscr.io/linuxserver/radarr:latest
    restart: unless-stopped
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER:-/opt}/radarr:/config
      - ${STORAGE:-/storage}:/storage
    depends_on:
      - swag
      - prowlarr
      - qbittorrent
    ports:
      - 127.0.0.1:7878:7878
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.centurylinklabs.watchtower.depends-on=swag,prowlarr,qbittorrent

  # Sonarr
  sonarr:
    container_name: sonarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/GMT}
    image: lscr.io/linuxserver/sonarr:latest
    restart: unless-stopped
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER:-/opt}/sonarr:/config
      - ${STORAGE:-/storage}:/storage
    depends_on:
      - swag
      - prowlarr
      - qbittorrent
    ports:
      - 127.0.0.1:8989:8989
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.centurylinklabs.watchtower.depends-on=swag,prowlarr,qbittorrent

  # Bazarr
  bazarr:
    container_name: bazarr
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Etc/GMT}
    image: lscr.io/linuxserver/bazarr:latest
    restart: unless-stopped
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER:-/opt}/bazarr:/config
      - ${STORAGE:-/storage}:/storage
    depends_on:
      - swag
      - sonarr
      - radarr
    ports:
      - 127.0.0.1:6767:6767
    labels:
      - com.centurylinklabs.watchtower.enable=true
      - com.centurylinklabs.watchtower.depends-on=swag,sonarr,radarr